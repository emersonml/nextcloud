
services:
  nextcloud:
    image: lscr.io/linuxserver/nextcloud:latest
    container_name: nextcloud
    hostname: nextcloud
    
    ports:
      - "8080:80"  # Ou use sua porta preferida
    
    environment:
      - PUID=911
      - PGID=911
      - UMASK=002
      - TZ=America/Sao_Paulo  # Ajuste seu fuso
      
      - MYSQL_HOST=mariadb
      - MYSQL_DATABASE=nextcloud
      - MYSQL_USER=nextcloud
      - MYSQL_PASSWORD=sua_senha_forte
      
      - NEXTCLOUD_TRUSTED_DOMAINS=localhost seu-ip seu-dominio
      - NEXTCLOUD_ADMIN_USER=admin
      - NEXTCLOUD_ADMIN_PASSWORD=senha_admin_forte
      
      - PHP_MEMORY_LIMIT=512M
      - PHP_UPLOAD_LIMIT=10G
    
    volumes:
      - ${DATA_DIR}/config:/config
      - ${DATA_DIR}/data:/data
      - ${DATA_DIR}/apps-persist:/apps-persist
    
    depends_on:
      - mariadb
      - redis
    
    networks:
      - nextcloud_network
    
    restart: unless-stopped
  
  mariadb:
    image: lscr.io/linuxserver/mariadb:latest
    container_name: nextcloud_mariadb
    
    environment:
      - PUID=911
      - PGID=911
      - TZ=America/Sao_Paulo
      - MYSQL_ROOT_PASSWORD=senha_root_forte
      - MYSQL_DATABASE=nextcloud
      - MYSQL_USER=nextcloud
      - MYSQL_PASSWORD=sua_senha_forte
    
    volumes:
      - ${DATA_DIR}/mysql:/var/lib/mysql
    
    networks:
      - nextcloud_network
    
    restart: unless-stopped
  
  redis:
    image: redis:7-alpine
    container_name: nextcloud_redis
    command: redis-server --appendonly yes
    
    volumes:
      - ${DATA_DIR}/redis:/data
    
    networks:
      - nextcloud_network
    
    restart: unless-stopped

networks:
  nextcloud_network:
    driver: bridge